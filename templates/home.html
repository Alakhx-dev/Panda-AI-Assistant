<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - AI Study Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">
</head>

<body>
    <!-- Top Right Buttons -->
    <div class="top-right-buttons">
        <button class="icon-button profile-button" onclick="openProfileModal()">
            <img id="profileImage" src="{{ url_for('static', filename='default-avatar.svg') }}" alt="Profile"
                class="profile-dp">
        </button>
        <button class="icon-button settings-button" onclick="toggleSettingsMenu()">‚öôÔ∏è</button>
    </div>

    <!-- Settings Dropdown -->
    <div id="settingsMenu" class="settings-dropdown">
        <div class="settings-option" onclick="applyLanguage('en')">English</div>
        <div class="settings-option" onclick="applyLanguage('hi')">Hindi</div>
        <div class="settings-option" onclick="window.location.href='mailto:admin@aistudyassistant.com'">Contact Admin
        </div>
        <div class="settings-option" onclick="logoutUser()">Logout</div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeProfileModal()">&times;</span>
            <h2>Update Profile Picture</h2>
            <div class="profile-options">
                <div class="profile-card" onclick="openCamera()">
                    <div class="card-icon">üì∑</div>
                    <h3>Camera</h3>
                </div>
                <div class="profile-card" onclick="openGallery()">
                    <div class="card-icon">üñºÔ∏è</div>
                    <h3>Gallery</h3>
                </div>
                <div class="profile-card" onclick="showBuiltInAvatars()">
                    <div class="card-icon">üë§</div>
                    <h3>Built-in Avatars</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Built-in Avatars Modal -->
    <div id="avatarsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAvatarsModal()">&times;</span>
            <h2>Select Avatar</h2>
            <div class="avatars-grid">
                <img src="{{ url_for('static', filename='avatars/avatar1.svg') }}"
                    onclick="selectBuiltInAvatar(this.src)" class="avatar-option">
                <img src="{{ url_for('static', filename='avatars/avatar2.svg') }}"
                    onclick="selectBuiltInAvatar(this.src)" class="avatar-option">
                <img src="{{ url_for('static', filename='avatars/avatar3.svg') }}"
                    onclick="selectBuiltInAvatar(this.src)" class="avatar-option">
                <img src="{{ url_for('static', filename='avatars/avatar4.svg') }}"
                    onclick="selectBuiltInAvatar(this.src)" class="avatar-option">
                <img src="{{ url_for('static', filename='avatars/avatar5.svg') }}"
                    onclick="selectBuiltInAvatar(this.src)" class="avatar-option">
                <img src="{{ url_for('static', filename='avatars/avatar6.svg') }}"
                    onclick="selectBuiltInAvatar(this.src)" class="avatar-option">
                <img src="{{ url_for('static', filename='avatars/avatar7.svg') }}"
                    onclick="selectBuiltInAvatar(this.src)" class="avatar-option">
                <img src="{{ url_for('static', filename='avatars/avatar8.svg') }}"
                    onclick="selectBuiltInAvatar(this.src)" class="avatar-option">
            </div>
        </div>
    </div>

    <!-- Crop Modal -->
    <div id="cropModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCropModal()">&times;</span>
            <h2>Crop Image</h2>
            <div id="cropContainer"></div>
            <button onclick="cropAndSaveImage()">Save</button>
        </div>
    </div>

    <div class="home-container">
        <h1 class="home-heading" id="greeting">
            <span class="greeting-en">How can I help you, {{ session['user'] }}?</span>
            <span class="greeting-hi">‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•à‡§∏‡•á ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å, {{ session['user'] }}?</span>
        </h1>
        <div class="pill-buttons">
            <a href="/summary" class="pill-button">Summary</a>
            <a href="/solution" class="pill-button">Solution</a>
            <a href="/notes" class="pill-button">Notes</a>
        </div>
    </div>

    <!-- Hidden inputs for camera/gallery -->
    <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none;"
        onchange="handleCameraInput(event)">
    <input type="file" id="galleryInput" accept="image/*" style="display:none;" onchange="handleGalleryInput(event)">

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script>
        // Load profile image on page load
        document.addEventListener('DOMContentLoaded', function () {
            const profileImage = localStorage.getItem('profileImage');
            if (profileImage) {
                document.getElementById('profileImage').src = profileImage;
            }
            const lang = localStorage.getItem('language') || 'en';
            document.documentElement.className = lang === 'hi' ? 'language-hi' : '';
        });
    </script>
</body>

</html>